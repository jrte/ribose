#! /bin/bash
version=$(cat version)
jars="$(dirname $(readlink -f $0))/../../jars"
path="$jars/$(cat version).jar"
target="com.characterforming.ribose.BaseTarget"
if (($#>1)) && [[ "$1" == "--target" ]]; then
	target="$2"
	shift 2
	if (($#>1)) && [[ "$1" == "--target-path" ]]; then
		path="$path:$(readlink -f $2)"
		shift 2
	fi
fi
if (($#==2)); then
	if [[ -d "$1" ]]; then
		dfadir="$1"
	else
		echo "Not a directory: $1"
		exit 1
	fi
	model="$2"
else 
	echo "Usage: compile [--target <target-classname> [--target-path <target-classpath>]] <dfa-directory-path> <model-file-path>"
	echo "Compiles automata from <dfa-directory-path> into <model-file-path>."
	echo "Default target is com.characterforming.ribose.BaseTarget."
	exit 1
fi
${JAVA_HOME}/bin/java -ea -cp "$path" com.characterforming.ribose.TCompile --target $target "$dfadir" "$model"
