<!--
 * JRTE is a recursive transduction engine for Java
 * 
 * Copyright (C) 2011,2022 Kim Briggs
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received copies of the GNU General Public License
 * and GNU Lesser Public License along with this program.  See 
 * LICENSE-lgpl-3.0 and LICENSE-gpl-3.0. If not, see 
 * <http://www.gnu.org/licenses/>.
-->

<project name="ribose-model" default="model">
	<path id="ribose.classpath">
		<pathelement location="jars/ribose-0.0.0.jar"/>
	</path>
  <target name="model">
		<ant antfile="./build.xml" target="clean-java"/>
		<ant antfile="./build.xml" target="package-java"/>
		<delete dir="build/ribose/automata" quiet="true"/>
  	<mkdir dir="build/ribose/automata"/>
		<exec failonerror="true" executable="/bin/bash">
			<arg line="etc/sh/patterns ribose-patterns alpha.inr after.inr build/ribose/automata"/>
		</exec>
		<java resultproperty="model-result" fork="true" dir ="." classname="com.characterforming.ribose.Ribose" classpathref="ribose.classpath" failonerror="true">
			<jvmarg line="-showversion -ea"/>
			<arg line="--target com.characterforming.jrte.engine.ModelCompiler build/ribose/automata build/ribose/ModelCompiler.model"/>
		</java>
	</target>
	<target name="deploy" depends="model">
		<echo message="./ModelCompiler.(map,model) -> ./ModelCompiler.(map,model).last"/>
		<move file="./ModelCompiler.map" tofile="./ModelCompiler.map.last"/>
		<move file="./ModelCompiler.model" tofile="./ModelCompiler.model.last"/>
		<echo message="build/ribose/ModelCompiler.(map,model) -> ./ModelCompiler.(map,model)"/>
		<move file="build/ribose/ModelCompiler.map" tofile="./ModelCompiler.map" preservelastmodified="true"/>
		<move file="build/ribose/ModelCompiler.model" tofile="./ModelCompiler.model" preservelastmodified="true"/>
		<ant antfile="./build.xml" target="all-clean"/>
	</target>
</project>
